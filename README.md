# PDF Reader Using AI

Проект предназначен для извлечения структурированных данных из медицинских PDF-документов с помощью моделей OpenAI. Скрипт читает файлы из директории входных данных, формирует промпт на основе заданной JSON-схемы и сохраняет ответы модели в виде JSON-файлов.


## Возможности
- Извлечение текста из PDF через `pdfplumber` (по умолчанию), `pypdf` и PyMuPDF (доступны вспомогательные функции в `reader.py`).
- Формирование промпта по заданной JSON-схеме и отправка в модель OpenAI для получения структурированного ответа.
- Сохранение сгенерированного промпта и ответа модели в отдельные файлы для отладки.
- Преобразование собранных JSON-ответов в агрегированные CSV-таблицы заявок и медикаментов (`tables.py`).

## Структура проекта
- `main.py` — основной сценарий: читает PDF, строит промпт, отправляет запрос в OpenAI и сохраняет JSON-ответ.
- `prompt.py` — шаблон промпта и целевая JSON-схема для извлечения данных.
- `reader.py` — функции чтения текста и полей форм из PDF разными библиотеками.
- `tables.py` — утилиты для конвертации JSON-ответов в CSV-таблицы и объединения результатов.
- `input_files/` — папка для исходных PDF (значение по умолчанию).
- `output_files/` — папка для сохранения промптов, ответов и агрегированных таблиц (значение по умолчанию).

## Установка
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate
pip install -r requirements.txt
```

## Настройка переменных окружения
Создайте файл `.env` в корне проекта и задайте ключевые переменные:
```env
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4.1-mini      # необязательно, есть значение по умолчанию
OPENAI_TEMPERATURE=0.2         # необязательно, есть значение по умолчанию
PDF_INPUT_DIR=input_files      # необязательно, есть значение по умолчанию
OUTPUT_DIR=output_files        # необязательно, есть значение по умолчанию
```

## Запуск обработки PDF
```bash
python main.py                 # обработает все PDF из PDF_INPUT_DIR
python main.py path/to/file.pdf  # чтобы указать конкретный файл
```

Для каждого PDF будут созданы:
- `<имя>_prompt.txt` — текст промпта, отправленного в модель.
- `<имя>_response.json` — структурированный ответ модели.

Если модель вернёт невалидный JSON, вместо него сохраняется `<имя>_BAD_RESPONSE.txt` с сырым ответом.

## Формирование сводных таблиц
После получения JSON-ответов запустите:
```bash
python tables.py
```
Скрипт найдёт все `*_response.json` в `OUTPUT_DIR`, сконвертирует их в два CSV-файла и добавит данные без дублей:
- `output_files/applications.csv` — общая таблица заявок.
- `output_files/medications.csv` — таблица медикаментов.

---

## Принятые решения во время реализации:
1) временно отказаться от распределения на парсинг и OCR 
причина: ограниченные ресурсы для реализации подобного решения. (время и вычислительные мощности)

2) отказаться от группировки нескольких pdf файлов для экономии токенов
причина: в рамках  текущего размера проекта это нецелесообразно. экономия минимальна, либо отсутствует. теряется лаконичность и простота кода.
повышается шанс переполнения памяти модели или ее ошибки. 

---

## Можно реализовать в будущем?

1) Параллельная обработка через asyncio (в случае если пополнение данных для анализа будет в формате реального времени)

2) интеграция запросов в https://ai-virgil.liambo.ai/
