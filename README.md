# PDF Reader Using AI

Проект предназначен для извлечения структурированных данных из медицинских PDF-документов с помощью моделей OpenAI. Скрипт читает файлы из директории входных данных, формирует промпт на основе заданной JSON-схемы и сохраняет ответы модели в виде JSON-файлов.


## Возможности
- Извлечение текста из PDF через `pdfplumber` (по умолчанию), `pypdf` и PyMuPDF (доступны вспомогательные функции в `reader.py`).
- Формирование промпта по заданной JSON-схеме и отправка в модель OpenAI для получения структурированного ответа.
- Сохранение сгенерированного промпта и ответа модели в отдельные файлы для отладки.
- Преобразование собранных JSON-ответов в агрегированные CSV-таблицы заявок и медикаментов (`tables.py`).

## Структура проекта
PDF_reader_using_AI/
│
├── main.py               — обработка PDF, генерация JSON
├── tables.py             — преобразование JSON → таблицы CSV
├── logging_config.py     — конфигурация логирования
├── prompts/              — промпты запросов в OpenAI
├── input_files/         — входные PDF
├── other_input_files/         — входные PDF не подходящие по формату
├── output_files/         — выходные JSON и CSV (git-ignore)
├── .venv/                — виртуальное окружение uv 
├── data_showcase.ipynb   — просмотр полученных таблиц
├── pyproject.toml        — зависимости проекта
├── uv.lock               — зафиксированные версии
├── .python-version       — версия Python для uv
└── README.md             — документация


## Установка и использование
### 1. Установка uv
```bash
pip install uv
```
### 2. Клонирование проекта
```bash
git clone https://github.com/ANDaniell/PDF_reader_using_AI.git
cd PDF_reader_using_AI
```
### 3. Установка зависимостей
```bash
uv sync
```
### 4. Настройка окружения
Создайте файл `.env` в корне проекта и задайте ключевые переменные:
```env
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4.1-mini      # необязательно, есть значение по умолчанию
OPENAI_TEMPERATURE=0.2         # необязательно, есть значение по умолчанию
PDF_INPUT_DIR=input_files      # необязательно, есть значение по умолчанию
OUTPUT_DIR=output_files        # необязательно, есть значение по умолчанию
```

## Запуск обработки PDF → JSON
```bash
uv run main               # обработает все PDF из PDF_INPUT_DIR
uv run main path/to/file.pdf # чтобы указать конкретный файл
python main.py path/to/file.pdf  # можно и стандартным способом
```

Для каждого PDF будут созданы:
- `<имя>_prompt.txt` — текст промпта, отправленного в модель.
- `<имя>_response.json` — структурированный ответ модели.
- `<имя>_BAD_RESPONSE.txt` — сырые данные, если модель вернула невалидный JSON.

Все шаги фиксируются в журнале (консоль + `logs/app.log`)

## Формирование сводных таблиц
После получения JSON-ответов запустите:
```bash
uv run tables
```
Скрипт найдёт все `*_response.json` в `OUTPUT_DIR` и сконвертирует их в два CSV-файла:
- `output_files/applications.csv` — общая таблица заявок.
- `output_files/medications.csv` — таблица медикаментов.

---

## Текущие задачи:

- [x] вернуть обработку медикаментов (приведение к стандартным ед измерения там где это возможно + дополнительные обработчики ошибок)

- [x] в reason_checking нужно записывать все не корректности которые были найдены

- [ ] значения по умолчанию

- [ ] Отсутствие дополнительной информации о членах семьи
В разделе "Дополнительная информация" должны были содержаться данные о членах семьи, однако эти данные отсутствуют или были удалены.
